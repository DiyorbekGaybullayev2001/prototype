<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,opsz,wght@0,6..12,200..1000;1,6..12,200..1000&display=swap"
        rel="stylesheet">
    <link href="../../src/style.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Чаты</title>
    <style>
        #contextMenu, #contextMenu-2{
            transform: scale(0.85) !important;
        }
        /* contextMenu'ni responsiv va to'g'ri joylash uchun */
#contextMenu {
    left: 50% !important;
    top: 0 !important;
    transform: translate(-30%, -5%) scale(0.85) !important;
    min-width: 320px;
    max-width: 95vw;
    width: 500px;
    box-sizing: border-box;
    z-index: 1200 !important;
}

@media (max-width: 600px) {
    #contextMenu {
        width: 95vw !important;
        min-width: 0 !important;
        padding: 12px !important;
        left: 50% !important;
        top: 0 !important;
        transform: translate(-50%, -50%) scale(0.98) !important;
    }
    #contextMenu ul {
        gap: 12px !important;
    }
    #contextMenu li {
        font-size: 15px !important;
        padding: 10px 10px 10px 18px !important;
    }
}
.input-container{
    width: 109%;
}
    </style>
</head>

<body class="bg-[#FDF7EF]">
    <div id="contextMenu" class="hidden absolute !top-[400px]  sm:!top-0 z-120 shadow-lg rounded-[30px] p-[25px] w-[500px] bg-[#2B2E3A] ">
        <ul class="text-[16px] font-bold text-black flex flex-col gap-[15px]">
            <li id="archive-chat"
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                Архивировать <img class="w-[60px] rounded-[60px]" src="/image/archiveW.svg" alt=""></li>
            <li
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                Закрепить <img class="w-[60px] rounded-[60px]" src="/image/pinW.svg" alt=""></li>
            <li id="toggle-notifications"
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                Выключить уведомления <img class="w-[60px] h-[60px] rounded-full" src="../image/bell2.svg" alt="">
            </li>
            <li
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                Пометить как непрочитанное <img class="w-[60px] rounded-[60px]" src="/image/messageW.svg" alt=""></li>
            <li
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                Очистить историю <img class="w-[60px] rounded-[60px]" src="/image/clearW.svg" alt=""></li>
            <li id="add-favorite"
                class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer">
                В избранное <img class="w-[60px] rounded-[60px]" src="../image/yesW.svg" alt=""></li>
            <li class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer"
                id="delete">
                Удалить <img class="w-[60px] rounded-[60px]" src="/image/trashW.svg" alt=""></li>
            <li class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer"
                id="select">
                Выбрать <img class="w-[60px] rounded-[60px]" src="/image/yesW.svg" alt=""></li>
            <li class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer"
                id="all-chats">
                Выделить все чаты <img class="w-[60px] rounded-[60px]" src="/image/yesW.svg" alt=""></li>
            <li class="menu-item py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer"
                id="cancel">
                Отменить <img class="w-[60px] rounded-[60px]" src="/image/clearW.svg" alt=""></li>

        </ul>
    </div>
    <div id="overlay" class="hidden z-100 fixed inset-0 !bg-[#ffffffa3]  backdrop-blur-md"></div>

    <div id="contextMenu-2"
         class="hidden absolute shadow-lg rounded-[30px] p-[25px] w-[975px] bg-[#2B2E3A] z-1007 max-[1100px]:w-[875px] max-[950px]:w-[675px] max-[750px]:w-[550px] max-[600px]:w-[400px] max-[600px]:p-[15px]">
        <ul
            class="text-[16px] font-bold text-black flex flex-col flex-wrap w-full max-h-[465px] gap-[25px] max-[900px]:max-h-full  max-[900px]:grid max-[900px]:grid-cols-2 max-[600px]:text-[14px] max-[500px]:gap-[15px]">
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%] ">
                Изменить проект<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/pencil.svg" alt=""></li>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Поставить на паузу<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/pause.svg" alt=""></li>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Возобновить проект<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/reload.svg" alt=""></li>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Закрыть проект<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/clearW.svg" alt=""></li>
            <a href="/pages/info-projects.html"
               class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Вся информация по проекту<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/info.svg" alt=""></a>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Результат сдан<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/yesW.svg" alt=""></li>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                <p class="max-w-[215px]">Заказчик оплатил проект/часть проекта</p><img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/rubles.svg" alt="">
            </li>
            <li
                class="menu-item max-w-[444px] py-[13px] pl-[25px] pr-[13px] bg-white w-[48%] rounded-[20px] flex justify-between items-center cursor-pointer max-[900px]:flex-col max-[900px]:items-start max-[900px]:w-[100%]">
                Спор с заказчиком<img
                class="w-[60px] rounded-[60px] max-[900px]:mt-[15px] max-[900px]:ml-auto max-[750px]:w-[45px]"
                src="/image/weight.svg" alt=""></li>


        </ul>
    </div>
    <div id="overlay-2" class="hidden fixed z-100 inset-0 !bg-[#ffffffa3] !backdrop-blur-md"></div>

    <div
        class=" max-w-7xl mt-0 mx-auto pb-[20px]  p-[0_15px] h-[100vh] flex flex-col max-[1000px]:overflow-y-hidden max-[1000px]:h-[90vh]">
        <header class=" flex justify-between mt-[66px] max-[700px]:mt-[36px] pr-[5px]">
            <div class="flex items-center gap-[25px]">
                <button id="defaultBackBtn"
                        class="bg-white-important py-[20px] px-[12px] rounded-[48px] flex justify-center items-center"
                        onclick="window.history.back(); return false;">
                    <img src="/image/arrow-l.svg" alt="">
                </button>
                <button id="backbutton"
                        class=" bg-white-important py-[20px] px-[12px] rounded-[48px] flex justify-center items-center hidden"
                        onclick="showChatList();">
                    <img src="/image/arrow-l.svg" alt="">
                </button>
                <a href="/pages/profile.html">
                    <img src="/image/avatar.png" alt="" class="max-w-[60px]">
                </a>
            </div>
            <div class="flex items-center gap-[25px]">
                <a href="/pages/main.html"
                   class="bg-2B2E3A rounded-[48px] font-bold text-[25px] leading-[34.1px] text-center text-white px-[55px] py-[12px] max-[900px]:hidden">
                    Вернуться на главную
                </a>
                <a href="/pages/main.html"
                   class="hidden bg-2B2E3A rounded-[68px] font-bold text-[25px] leading-[34.1px] text-center text-white px-[18px] py-[18px] max-[900px]:flex">
                    <img src="/image/home-icoW.svg" class="w-[25px]" alt="">
                </a>
                <button id="showContextBtn"
                        class="hidden rounded-[68px] font-bold text-[25px] leading-[34.1px] text-center text-white max-w-[58px] max-h-[58px]">
                    <img src="/image/pointer.svg" alt="" id="btnImage">
                </button>
            </div>
        </header>

        <main class=" flex flex-col w-full flex-1 overflow-hidden">
            <div class=" flex flex-1  gap-[1px] mt-[30px] min-h-0 max-[1000px]:gap-0">
                <div id="archive-inner"
                     class="archive-inner hidden bg-[#E4E4E4] p-[20px] w-[40%] rounded-[35px] h-full">
                    <nav class="flex items-center gap-[13px] mb-[25px]">
                        <li id="archive-btn"
                            class="cursor-pointer flex items-center justify-center list-none bg-white min-w-[40px] h-[40px] font-light text-[16px] leading-[30px] rounded-[30px] text-black">
                            <img class="w-[20px]" src="/image/arrow-l.svg" alt="">
                            </button>
                        </li>
                        <li
                            class="cursor-pointer flex items-center list-none bg-white p-[5px_27px_5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[550px]:hidden">
                            Все</li>
                        <li
                            class="cursor-pointer flex items-center list-none bg-white p-[5px_27px_5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[550px]:hidden">
                            Непрочитанные</li>
                        <li
                            class="cursor-pointer flex items-center list-none bg-white p-[5px_27px_5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[550px]:hidden">
                            Избранное</li>
                    </nav>


                    <div id="archived-chats"
                         class="chats  flex flex-col flex-1 min-h-0 gap-[10px] overflow-y-auto mt-[20px] ">

                    </div>
                </div>
                <div id="left"
                
                     class="flex flex-col w-[42%] bg-[#E4E4E4] p-[20px] rounded-[35px] overflow-hidden min-h-0   max-[550px]:p-[15px_10px] ">
                    <div id="search-container" class="flex items-center border border-[#CECECE] p-[10px] rounded-[100px] w-full">
                        <img src="/image/loop.svg" alt="Поиск" class="mr-2" width="30">
                        <input id="search-input" type="text" placeholder="Поиск" class="w-full outline-none bg-transparent text-lg">
                       
                        <button id="clear-search" class="ml-2 text-gray-400 hover:text-blue-950 focus:outline-none" aria-label="Очистить" style="display:none;">
                          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                           <path stroke-linecap="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                         </svg>
                        </button>
                    </div>

                    <nav id="nav-area" class="flex items-center gap-[20px] mt-[25px] mb-[25px]">
                        <li class="cursor-pointer flex items-center list-none bg-[#ffffff] p-[5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[500px]:text-[14px] max-[500px]:p-[5px_22px]">Все</li>
                        <li class="cursor-pointer flex items-center list-none bg-[#ffffff] p-[5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[500px]:text-[14px] max-[500px]:p-[5px_22px]">Непрочитанные</li>
                        <li class="cursor-pointer flex items-center list-none bg-[#ffffff] p-[5px_27px] font-light text-[16px] leading-[30px] rounded-[30px] text-black max-[500px]:text-[14px] max-[500px]:p-[5px_22px]">Избранное</li>
                    </nav>
                   
                    <!-- <a href="./archive.html">
                        <h3 
                        class="flex items-center cursor-pointer gap-[25px] bg-[#E4E4E4] px-[25px] py-[10px] rounded-[20px] transition hover:bg-[#d4d4d4]">
                        <img src="/image/archive.svg" alt="">
                        <span class="text-[16px] font-bold">В архиве </span>
                    </h3>
                    </a> -->
                   

                    <div id="chat-list" class="chats flex flex-col flex-1 min-h-0 gap-[10px] overflow-y-auto  p-[12px]">
                        <div class="chat-container">

                            <div
                                class="message select bg-[#E4E4E4] relative cursor-pointer flex items-start justify-between p-[10px] rounded-[30px] pin chat-item">
                                <div class="flex items-start gap-[10px] max-[500px]:gap-[10px]">
                                    <div id="select-dot"
                                         class="hidden flex justify-center my-auto w-[22px] h-[22px] rounded-[68px] bg-transparent border border-black items-center">
                                        <img id="dot-image" class="hidden max-w-[12.5px]" src="/image/choose.svg" alt="">
                                    </div>
                                    <img class="w-[60px] rounded-[20px] h-[60px] " src="/image/chat-img.png" alt="" >
                                    <div class="message-title">
                                        <h4 class="font-bold text-[18px]">Наименование</h4>
                                        <p class="font-normal text-[16px]">Описание</p>
                                    </div>
                                </div>
                                <div class="message-info flex flex-col items-end gap-[8px] pt-[2px]">
                                    <p class="font-bold text-[14px] mt-0.5 mr-1">25.11.2024</p>
                                    <div class="message-meta flex items-center gap-[10px]">
                                        <!-- <img class="h-[20px]" src="/image/pin.svg" alt=""> -->
                                        <span
                                        class="bg-[#A0ED9F] py-[3px] px-[8px] rounded-[30px] text-black font-bold text-[12px]">1</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container">

                            <div
                                class="message select bg-[#E4E4E4] relative cursor-pointer flex items-start justify-between p-[10px] rounded-[30px] pin chat-item">
                                <div class="flex items-start gap-[10px] max-[500px]:gap-[10px]">
                                    <div id="select-dot"
                                         class="hidden flex justify-center my-auto w-[22px] h-[22px] rounded-[68px] bg-transparent border border-black items-center">
                                        <img id="dot-image" class="hidden max-w-[12.5px]" src="/image/choose.svg" alt="">
                                    </div>
                                    <img class="w-[60px] rounded-[20px] h-[60px] " src="/image/chat-img.png" alt="" >
                                    <div class="message-title">
                                        <h4 class="font-bold text-[18px]">Наименование</h4>
                                        <p class="font-normal text-[16px]">Описание</p>
                                    </div>
                                </div>
                                <div class="message-info  flex flex-col items-end gap-[8px] pt-[2px]">
                                    <p class="font-bold text-[14px] mt-0.5 mr-1">25.11.2024</p>
                                    <div class="message-meta flex items-center gap-[10px]">
                                        <!-- <img class="h-[20px]" src="/image/pin.svg" alt=""> -->
                                        <span
                                        class="bg-[#A0ED9F] py-[3px] px-[8px] rounded-[30px] text-black font-bold text-[12px]">1</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container">

                            <div
                                class="message select bg-[#E4E4E4] relative cursor-pointer flex items-start justify-between p-[10px] rounded-[30px] pin chat-item">
                                <div class="flex items-start gap-[10px] max-[500px]:gap-[10px]">
                                    <div id="select-dot"
                                         class="hidden flex justify-center my-auto w-[22px] h-[22px] rounded-[68px] bg-transparent border border-black items-center">
                                        <img id="dot-image" class="hidden max-w-[12.5px]" src="/image/choose.svg" alt="">
                                    </div>
                                    <img class="w-[60px] rounded-[20px] h-[60px] " src="/image/chat-img.png" alt="" >
                                    <div class="message-title">
                                        <h4 class="font-bold text-[18px]">Наименование</h4>
                                        <p class="font-normal text-[16px]">Описание</p>
                                    </div>
                                </div>
                                <div class="message-info flex flex-col items-end gap-[8px] pt-[2px]">
                                    <p class="font-bold text-[14px] mt-0.5 mr-1">25.11.2024</p>
                                    <div class="message-meta flex items-center gap-[10px]">
                                        <!-- <img class="h-[20px]" src="/image/pin.svg" alt=""> -->
                                        <span
                                        class="bg-[#A0ED9F] py-[3px] px-[8px] rounded-[30px] text-black font-bold text-[12px]">1</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                       <div class="chat-container">

                            <div
                                class="message select bg-[#E4E4E4] relative cursor-pointer flex items-start justify-between p-[10px] rounded-[30px] pin chat-item">
                                <div class="flex items-start gap-[10px] max-[500px]:gap-[10px]">
                                    <div id="select-dot"
                                         class="hidden flex justify-center my-auto w-[22px] h-[22px] rounded-[68px] bg-transparent border border-black items-center">
                                        <img id="dot-image" class="hidden max-w-[12.5px]" src="/image/choose.svg" alt="">
                                    </div>
                                    <img class="w-[60px] rounded-[20px] h-[60px] " src="/image/chat-img.png" alt="" >
                                    <div class="message-title">
                                        <h4 class="font-bold text-[18px]">Наименование</h4>
                                        <p class="font-normal text-[16px]">Описание</p>
                                    </div>
                                </div>
                                <div class="message-info flex flex-col items-end gap-[8px] pt-[2px]">
                                    <p class="font-bold text-[14px] mt-0.5 mr-1">25.11.2024</p>
                                    <div class="message-meta flex items-center gap-[10px]">
                                        <!-- <img class="h-[20px]" src="/image/pin.svg" alt=""> -->
                                        <span
                                        class="bg-[#A0ED9F] py-[3px] px-[8px] rounded-[30px] text-black font-bold text-[12px]">1</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="chat-container">

                            <div
                                class="message select bg-[#E4E4E4] relative cursor-pointer flex items-start justify-between p-[10px] rounded-[30px] pin chat-item">
                                <div class="flex items-start gap-[10px] max-[500px]:gap-[10px]">
                                    <div id="select-dot"
                                         class="hidden flex justify-center my-auto w-[22px] h-[22px] rounded-[68px] bg-transparent border border-black items-center">
                                        <img id="dot-image" class="hidden max-w-[12.5px]" src="/image/choose.svg" alt="">
                                    </div>
                                    <img class="w-[60px] rounded-[20px] h-[60px] " src="/image/chat-img.png" alt="" >
                                    <div class="message-title">
                                        <h4 class="font-bold text-[18px]">Наименование</h4>
                                        <p class="font-normal text-[16px]">Описание</p>
                                    </div>
                                </div>
                                <div class="message-info flex flex-col items-end gap-[8px] pt-[2px]">
                                    <p class="font-bold text-[14px] mt-0.5 mr-1">25.11.2024</p>
                                    <div class="message-meta flex items-center gap-[10px]">
                                        <!-- <img class="h-[20px]" src="/image/pin.svg" alt=""> -->
                                        <span
                                        class="bg-[#A0ED9F] py-[3px] px-[8px] rounded-[30px] text-black font-bold text-[12px]">1</span>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div
                    class="rights flex flex-col flex-1 w-[50%] overflow-hidden min-h-0 relative gap-20px max-[1200px]:w-[65%]">
                    <div id="messages"
                         class="messages flex flex-col flex-1 min-h-0 overflow-y-auto gap-[30px] rounded-[35px]">

                    </div>
                    <div class="input-container ml-[-33px] transform scale-[0.95] !max-w-[850px] bg-white p-[10px] flex items-center gap-[10px] rounded-[20px]"
                         id="inputBox">
                        <textarea id="messageInput"
                                  class="flex-1 max-h-[200px] !h-[50px] outline-none !text-[20px]  overflow-y-auto resize-none p-[10px] border-none rounded-[10px]"
                                  placeholder="Написать сообщение"></textarea>
                       <button id="sendMessage" class="bg-[#EDDA9F]  rounded-full w-[48px] h-[48px] flex items-center justify-center text-black text-xl shadow" aria-label="Отправить">
        <img src="/image/arrow-r.svg" alt="Отправить" class="w-6 h-6">
    </button>
                    </div>

                </div>
            </div>
            <div id="previewOverlay" class="hidden"></div>
            <div id="chatPreview" class="hidden">
                <h3 id="previewTitle">Превью чата</h3>
                <p id="previewDescription">Описание превью</p>
                <button id="previewCloseBtn">Закрыть</button>
            </div>
        </main>

    </div>

    <script>
        // ...existing code...

// #left ichidagi barcha elementlarni 20% ga kichraytirish (JS orqali style o‘zgartirish)
function scaleLeftElements() {
    const left = document.getElementById('left');
    if (!left) return;
    // left konteynerning o‘zini ham scale qilamiz
    // left.style.transform = 'scale(0.8)';
    // left.style.transformOrigin = 'top left';
    // Faqat child elementlarni tanlab, har biriga style beramiz
    left.querySelectorAll('*').forEach(el => {
        el.style.fontSize = el.style.fontSize
            ? (parseFloat(el.style.fontSize) * 0.7) + (el.style.fontSize.replace(/[0-9.]/g, '')) // px, rem, va h.k.
            : '';
        el.style.padding = el.style.padding
            ? (parseFloat(el.style.padding) * 0.7) + (el.style.padding.replace(/[0-9.]/g, ''))
            : '';
        el.style.margin = el.style.margin
            ? (parseFloat(el.style.margin) * 0.7) + (el.style.margin.replace(/[0-9.]/g, ''))
            : '';
        // Rasm va svg uchun ham width/height
        if (el.tagName === 'IMG' || el.tagName === 'SVG') {
            if (el.width) el.width = el.width * 0.7;
            if (el.height) el.height = el.height * 0.7;
            el.style.maxWidth = el.style.maxWidth ? (parseFloat(el.style.maxWidth) * 0.8) + (el.style.maxWidth.replace(/[0-9.]/g, '')) : '';
            el.style.maxHeight = el.style.maxHeight ? (parseFloat(el.style.maxHeight) * 0.8) + (el.style.maxHeight.replace(/[0-9.]/g, '')) : '';
        }
    });
}

// Sahifa yuklanganda yoki kerakli vaqtda chaqiring:
scaleLeftElements();

// ...existing code...



    // #rights va ichidagi barcha elementlarni 20% ga kichraytirish (JS orqali style o‘zgartirish)
    function scaleRightsElements() {
        const rights = document.querySelector('.rights');
        if (!rights) return;

        // rights konteynerining o‘zini ham scale qilamiz
        rights.style.transform = 'scale(0.98)';
        // rights.style.transformOrigin = 'top left';

        // Faqat child elementlarni tanlab, har biriga style beramiz
        rights.querySelectorAll('*').forEach(el => {
            // Font size
            if (el.style.fontSize) {
                el.style.fontSize = (parseFloat(el.style.fontSize) * 0.8) + (el.style.fontSize.replace(/[0-9.]/g, ''));
            }
            // Padding
            if (el.style.padding) {
                el.style.padding = (parseFloat(el.style.padding) * 0.8) + (el.style.padding.replace(/[0-9.]/g, ''));
            }
            // Margin
            if (el.style.margin) {
                el.style.margin = (parseFloat(el.style.margin) * 0.8) + (el.style.margin.replace(/[0-9.]/g, ''));
            }
            // Rasm va svg uchun ham width/height
            if (el.tagName === 'IMG' || el.tagName === 'SVG') {
                if (el.width) el.width = el.width * 0.8;
                if (el.height) el.height = el.height * 0.8;
                if (el.style.maxWidth) {
                    el.style.maxWidth = (parseFloat(el.style.maxWidth) * 0.8) + (el.style.maxWidth.replace(/[0-9.]/g, ''));
                }
                if (el.style.maxHeight) {
                    el.style.maxHeight = (parseFloat(el.style.maxHeight) * 0.8) + (el.style.maxHeight.replace(/[0-9.]/g, ''));
                }
            }
        });
    }

    // Sahifa yuklanganda yoki kerakli vaqtda chaqiring:
    scaleRightsElements();

    // ...existing code...


    // ...existing code...
    // ...existing code...

    // Har bir chat uchun pin va bell holatini saqlash uchun massiv
    const chatStates = new Map();

    // Chat-item'ga o'ng tugma bosilganda selectedChat ni saqlash va id olish
    document.querySelectorAll('.chat-item').forEach((item, idx) => {
        item.dataset.chatId = idx; // har bir chatga id biriktiramiz
        item.addEventListener('contextmenu', function(e) {
            selectedChat = this;
        });
        // Har bir chat yuklanganda holatini tiklash
        updateChatIcons(item);
    });

    // Universal funksiya: chatga pin/bell ikonkasini qo'yish yoki olib tashlash
    function updateChatIcons(chat) {
        const messageInfo = chat.querySelector('.message-meta');
        if (!messageInfo) return;
        // Pin
        let pinImg = messageInfo.querySelector('img[alt="pin"]');
        if (pinImg) pinImg.remove();
        if (chatStates.get(chat.dataset.chatId)?.pin) {
            const newPin = document.createElement('img');
            newPin.src = '/image/pin.svg';
            newPin.alt = 'pin';
            newPin.style.width = '18px';
            // newPin.style.marginLeft = '6px';
            messageInfo.appendChild(newPin);
        }
        // Bell
        let bellImg = messageInfo.querySelector('img[alt="bell"]');
        if (bellImg) bellImg.remove();
        if (chatStates.get(chat.dataset.chatId)?.bell) {
            const newBell = document.createElement('img');
            newBell.src = '../image/bell.svg';
            newBell.alt = 'bell';
            newBell.style.width = '20px';
            // newBell.style.marginLeft = '6px';
            messageInfo.appendChild(newBell);
        }
    }

    // ...existing code...

// "Выключить уведомления" tugmasi bosilganda contextMenu ichidagi rasmni ham o‘zgartirish
// const toggleNotificationsLi = document.getElementById('toggle-notifications');
// if (toggleNotificationsLi) {
//     toggleNotificationsLi.addEventListener('click', function () {
//         const bellIcon = toggleNotificationsLi.querySelector('img');
//         if (!bellIcon) return;
//         // Toggle bell icon
//         if (bellIcon.src.includes('bell2.svg')) {
//             bellIcon.src = '../image/bell.svg';
//         } else {
//             bellIcon.src = '../image/bell2.svg';
//         }
//     });
// }


// ...existing code...

    // "Закрепить" tugmasi bosilganda faqat tanlangan chat uchun emas, holatni massivda saqlaymiz
    document.querySelectorAll('#contextMenu .menu-item').forEach((menuItem, idx) => {
        // 2-chi li - "Закрепить"
        if (idx === 1) {
            menuItem.addEventListener('click', function() {
                if (!selectedChat) return;
                const chatId = selectedChat.dataset.chatId;
                const state = chatStates.get(chatId) || {};
                state.pin = !state.pin;
                chatStates.set(chatId, state);
                updateChatIcons(selectedChat);
            });
        }
        // 3-chi li - "Выключить уведомления"
        if (idx === 2) {
            menuItem.addEventListener('click', function() {
                if (!selectedChat) return;
                const chatId = selectedChat.dataset.chatId;
                const state = chatStates.get(chatId) || {};
                state.bell = !state.bell;
                chatStates.set(chatId, state);
                updateChatIcons(selectedChat);
            });
        }
    });

    // ...existing code...

    // ...existing code...

    // "Меню по проекту" tugmasini faqat chat tanlanganda ko‘rsatish
    const projectMenuBtn = document.getElementById('showContextBtn');
    const btnImage = document.getElementById('btnImage');
    let isProjectMenuActive = false;

    if (projectMenuBtn) projectMenuBtn.classList.add('hidden'); // Dastlab yashirin

    const chatItems = document.querySelectorAll('.chat-item');

    chatItems.forEach(item => {
        item.addEventListener('click', function (e) {
            e.stopPropagation();
            chatItems.forEach(c => c.classList.remove('active-chat'));
            this.classList.add('active-chat');
            projectMenuBtn.classList.remove('hidden');
            // Tugma rasmni defaultga qaytarish
            if (btnImage) btnImage.src = '/image/pointer.svg';
            isProjectMenuActive = false;
        });
    });

    projectMenuBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        if (!isProjectMenuActive) {
            // Rasmni clearW.svg ga o‘zgartirish
            if (btnImage) btnImage.src = '/image/clearW.svg';
            isProjectMenuActive = true;
        } else {
            // Rasmni avvalgi holatga qaytarish va tugmani yashirish
            if (btnImage) btnImage.src = '/image/pointer.svg';
            isProjectMenuActive = false;
            projectMenuBtn.classList.add('hidden');
            chatItems.forEach(c => c.classList.remove('active-chat'));
        }
    });

    // Chatdan va tugmadan tashqariga bosilganda tugmani yashirish va rasmni tiklash
    document.addEventListener('click', function (e) {
        const isChat = e.target.closest('.chat-item');
        const isBtn = e.target.closest('#showContextBtn');
        if (!isChat && !isBtn) {
            projectMenuBtn.classList.add('hidden');
            chatItems.forEach(c => c.classList.remove('active-chat'));
            if (btnImage) btnImage.src = '/image/pointer.svg';
            isProjectMenuActive = false;
        }
    });

    // ...existing code...

    const searchInput = document.getElementById('search-input');
    const clearSearchBtn = document.getElementById('clear-search');
    const left = document.getElementById('left');

    // Yashirish uchun left ichidagi barcha elementlarni tanlaymiz (search-container dan tashqari)
    let leftHideElements = [];
    if (left) {
        leftHideElements = Array.from(left.children).filter(
            el => el.id !== 'search-container'
        );
    }

    // Inputga bosilganda left ichidagi boshqa elementlarni yashirish
    if (searchInput && clearSearchBtn) {
        searchInput.addEventListener('focus', function () {
            leftHideElements.forEach(el => el.style.display = 'none');
            // X tugmasini ko‘rsatish (agar inputda qiymat bo‘lsa)
            if (this.value.length > 0) {
                clearSearchBtn.style.display = 'inline-flex';
            }
        });
        // Inputga yozilganda X tugmasini ko‘rsatish/yashirish
        searchInput.addEventListener('input', function () {
            if (this.value.length > 0) {
                clearSearchBtn.style.display = 'inline-flex';
            } else {
                clearSearchBtn.style.display = 'none';
            }
        });
        // Inputdan chiqilganda (blur) yana ko‘rsatish
        searchInput.addEventListener('blur', function () {
            setTimeout(() => { // X tugmasi bosilganda ham blur bo‘ladi, shuning uchun biroz kechiktiramiz
                if (this.value.length === 0) {
                    leftHideElements.forEach(el => el.style.display = '');
                    clearSearchBtn.style.display = 'none';
                }
            }, 150);
        });
        // X tugmasi bosilganda inputni tozalash va elementlarni ko‘rsatish
        clearSearchBtn.addEventListener('click', function () {
            searchInput.value = '';
            clearSearchBtn.style.display = 'none';
            leftHideElements.forEach(el => el.style.display = '');
            searchInput.focus();
        });
    }

    // ...existing code...


    </script>


    <script src="/main.js"></script>
</body>
</html>